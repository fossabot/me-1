language: node_js

node_js:
- '6'

env:
- CXX=g++-4.8

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8

before_install:
- touch .env

script: npm run travis

before_deploy:
- touch .env
- mkdir -p ../dpl_cd_upload
- tar -zcf ../dpl_cd_upload/me.words.tar.gz -C ./ .

deploy:
- provider: s3
  access_key_id: AKIAIIJQMCB7NWCX5LNA
  secret_access_key: &1
    secure: sP3nE5E3PBoBAvg3YhZ10Nfyxbi9Nh1+exm+YEUmLR396rLDFQFbkjKPrB4/Cn4XxIXX6s3NbuZCPF+d/spY+7XRmus1n50Tq1AF3AgZgwqnZj4BXIkvcUee1ud4oMoaXMX8E4HObvQe+y4f1uPv3njW8pe4ahVa6sjx5ZvflfW3Gl2fda6IM51828TthudMBw51QiOlW535QF3OlYB2jyD1IBt783cwgqxJ58eGX+5idjn1kcbOqMbAOQdN8ANf60YVTjekyhweO8mKuZaQuR8R1eupm2k8OU4FSBoLKU60DvqbWaebxZK+xHEqB6svN85Yy04XbhaT9nfaE/ostg6KtPhImJu7KDnFOjb4ByK4ZlYTNhPyyYpS6qN7pdJxZf/MlSeAqDNdQbMqdkhpS2/5F4np7qunm6mHnP97BEjeCTbUTUwWZ2ngjsxkWY+iCCbW1atbsthiNDOt5qA2Vqy+zDmxC3xNoKVz10KLmUCGGcUBuzzYAidxALcG9GuozIwUL2/R8YA4qE7AeMKPdqCprcqpkC6zmww5fVtp0dHYapYb+lOBdchUFGFsPQxTcXzxFCGgc6jGv7U9ipfNHHjvACgEgT/eaLEvZ3QhM2ZlOt22gBlbzIi0wXnfPW6HnOXl/bh9NJZMMedz5l4irzfelADkkpniuaG3FdeWJP8=
  skip_cleanup: true
  on: &2
    repo: randytarampi/me.words
    branch: master
  bucket: randytarampi-releases
  region: eu-west-1
  detect_encoding: true
  local-dir: ../dpl_cd_upload
- provider: codedeploy
  access_key_id: AKIAIIJQMCB7NWCX5LNA
  secret_access_key: *1
  bucket: randytarampi-releases
  key: me.words.tar.gz
  bundle_type: tgz
  application: me.words
  deployment_group: web
  on: *2
  wait-until-deployed: true
  region: eu-west-1
